<?xml version="1.0" encoding="utf-8"?>
<Project DefaultTargets="Build" ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <ItemGroup>
    <VlcMacX64IncludeFiles Condition="'@(VlcMacX64IncludeFiles)'==''" Include="lib\%2A%2A;plugins\%2A%2A;share\%2A%2A" />
  </ItemGroup>
  <PropertyGroup>
    <VlcMacX64TargetDir Condition=" '$(VlcMacX64TargetDir)' == '' ">libvlc\osx-x64</VlcMacX64TargetDir>
    <VlcMacX64Enabled Condition="'$(VlcMacX64Enabled)' == '' AND ('$(Platform)' == 'x64' OR '$(Platform)' == 'AnyCPU')">true</VlcMacX64Enabled>
  </PropertyGroup>
  <Target Name="CopyLibVLCToOutput" BeforeTargets="BeforeBuild" Condition="$(TargetFramework.StartsWith('net'))">
    <ItemGroup Condition="'$(VlcMacX64Enabled)' == 'true'">
      <VlcMacX64IncludeFilesFullPath Include="$([MSBuild]::Unescape($(MSBuildThisFileDirectory)..\build\osx-x64\%(VlcMacX64IncludeFiles.Identity)))" />
      <VlcMacX64ExcludeFilesFullPath Include="$([MSBuild]::Unescape($(MSBuildThisFileDirectory)..\build\osx-x64\%(VlcMacX64ExcludeFiles.Identity)))" Condition="'%(VlcMacX64ExcludeFiles.Identity)'!=''" />

      <Content Include="@(VlcMacX64IncludeFilesFullPath)" Exclude="@(VlcMacX64ExcludeFilesFullPath)">
        <Link>$(VlcMacX64TargetDir)\$([MSBuild]::MakeRelative($(MSBuildThisFileDirectory)..\build\osx-x64\, %(FullPath)))</Link>
        <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
      </Content>
    </ItemGroup>
  </Target>

  <PropertyGroup>
    <CreateAppBundleDependsOn>$(CreateAppBundleDependsOn);CopyLibVLCToAppBundle</CreateAppBundleDependsOn>
  </PropertyGroup>
  <Target Name="CopyLibVLCToAppBundle">
    <ItemGroup>
      <VlcMacX64IncludeLibFiles Include="$(MSBuildThisFileDirectory)osx-x64/lib/*.dylib" />
      <VlcMacX64IncludePluginsFiles Include="$(MSBuildThisFileDirectory)osx-x64/plugins/*.dylib" />
      <VlcMacX64IncludeShareFiles Include="$(MSBuildThisFileDirectory)osx-x64/share/**/**" />
    </ItemGroup>

    <Copy SourceFiles="@(VlcMacX64IncludeLibFiles)" 
      DestinationFiles="@(VlcMacX64IncludeLibFiles->'$(AppBundleDir)/Contents/MonoBundle/lib/%(RecursiveDir)%(Filename)%(Extension)')" />

    <Copy SourceFiles="@(VlcMacX64IncludePluginsFiles)"
      DestinationFiles="@(VlcMacX64IncludePluginsFiles->'$(AppBundleDir)/Contents/MonoBundle/plugins/%(RecursiveDir)%(Filename)%(Extension)')" />

    <Copy SourceFiles="@(VlcMacX64IncludeShareFiles)" 
      DestinationFiles="@(VlcMacX64IncludeShareFiles->'$(AppBundleDir)/Contents/MonoBundle/share/%(RecursiveDir)%(Filename)%(Extension)')" />
  </Target>
</Project>